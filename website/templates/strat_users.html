{% extends "base.html" %}
{% block title %}Stratify Users{% endblock %}

{% block content %}
<style>
  body {
      background: linear-gradient(-45deg, #ffffff, #fdf5e6, #faebd7, #f5deb3);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        font-family: "Poppins", sans-serif;
        color: #000000;
        height: 100vh;
    }

    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }
    
        50% {
            background-position: 100% 50%;
        }
    
        100% {
            background-position: 0% 50%;
        }
    }
  h1, h3, h4 {
    font-weight: 700;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
  }
  h1 {
    font-size: 3rem;
  }
  h3 {
    font-size: 1.5rem;
  }
  h4 {
    font-size: 1.2rem;
  }
  #notes {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    overflow: hidden;
    margin-top: 20px;
  }
  .list-group-item {
    background-color: rgba(255, 255, 255, 0.1);
    color: #000000;
    border: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
  }
  .list-group-item:last-child {
    border-bottom: none;
  }
  .list-group-item:hover {
    background-color: rgba(255, 255, 255, 0.3);
    transform: scale(1.02);
  }
  .close {
    color: #000000;
    opacity: 0.7;
    font-size: 1.5rem;
    transition: opacity 0.3s ease;
  }
  .close:hover {
    opacity: 1;
  }
  form {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    margin-top: 20px;
  }
  textarea {
    background-color: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 8px;
    color: #000000;
    padding: 10px;
    font-size: 1rem;
    resize: none;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
    width: 100%;
    height: 300px;
  }
  textarea:focus {
    outline: none;
    background-color: rgba(255, 255, 255, 0.3);
  }
  button {
    font-size: 1rem;
    font-weight: 700;
    background-color: #0e70b7;
    border: none;
    border-radius: 50px;
    padding: 10px 30px;
    color: #ffffff;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }
  button:hover {
    background-color: #3bff55;
    transform: scale(1.05);
  }
</style>
<div class="text-center mt-4">
  {% if not class_year %}
  <h1>Select a Class Year to Stratify</h1>
  <form method="GET" action="/strat-users">
    <div class="form-group">
      <select name="class_year" class="form-select text-center rounded-pill shadow-sm border-primary" 
      style="min-height: 30px; min-width: 300px;" required>
        <option value="" disabled selected>Select Class Year</option>
        {% for cy in class_years %}
        <option value="{{ cy }}">{{ cy }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit">Submit</button>
  </form>
  {% elif user1 and user2 %}
  <h3>Binary Comparison for Class Year {{ class_year }}</h3>
  <form method="POST" action="/strat-users?class_year={{ class_year }}">
    <input type="hidden" name="winner" value="{{ user1.User.id }}">
    <input type="hidden" name="loser" value="{{ user2.User.id }}">

    <div class="row">
      <div class="col-md-6 text-center">
        <h4>{{ user1.User.first_name }} {{ user1.User.last_name }}</h4>
        <p><strong>Narrative:</strong> {{ user1.Note.data }}</p>
      </div>
      <div class="col-md-6 text-center">
        <h4>{{ user2.User.first_name }} {{ user2.User.last_name }}</h4>
        <p><strong>Narrative:</strong> {{ user2.Note.data }}</p>
      </div>
    </div>

    <table class="table mt-4">
      <thead>
        <tr>
          <th>Criterion</th>
          <th>{{ user1.User.first_name }} {{ user1.User.last_name }}</th>
          <th>{{ user2.User.first_name }} {{ user2.User.last_name }}</th>
        </tr>
      </thead>
      <tbody>
        {% for criterion in ['overall', 'duty_performance', 'professionalism', 'leadership', 'character'] %}
        <tr>
          <td>{{ criterion.replace('_', ' ').capitalize() }}</td>
          <td>
            <input type="radio" name="{{ criterion }}_winner" value="winner" required>
          </td>
          <td>
            <input type="radio" name="{{ criterion }}_winner" value="loser" required>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit">Submit Stratification</button>
  </form>
  {% else %}
  <h3>Stratification Finished</h3>
  <img src="https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif" alt="Dancing Baby" class="img-fluid">
  {% endif %}
</div>
{% endblock %}
